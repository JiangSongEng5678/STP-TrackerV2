<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>安利对象跟进系统 (Amway Prospect Tracker)</title>
    <link rel="stylesheet" href="libs/flatpickr.min.css">
    <link rel="stylesheet" href="libs/monthSelect.css">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#0d47a1">
    
    <style>
        :root {
            --primary-color: #0d47a1; 
            --secondary-color: #f1f5f9; 
            --accent-color: #10b981; 
            --danger-color: #ef4444;
            --warning-color: #f59e0b; 
            --info-color: #3b82f6; 
            --text-color: #1e2023; /* Darker, more readable main text */
            --light-text-color: #fff;
            --text-color-light: #2d3032; /* Softer, clearer secondary text */
            --border-radius: 12px; 
            --box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            --card-bg: rgba(255, 255, 255, 0.95);
            --border-color: #e2e8f0;
        }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; 
            margin: 0; 
            padding: 20px; 
            background-color: var(--secondary-color); 
            color: var(--text-color); 
            line-height: 1.6;
            background-image: url('https://www.transparenttextures.com/patterns/diamond-upholstery.png');
        }
        #loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--secondary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            opacity: 1;
            transition: opacity 0.5s ease-out;
        }
        #loading-screen.hidden {
            opacity: 0;
            pointer-events: none;
        }
        .welcome-message {
            text-align: center;
            opacity: 0; /* Start hidden */
            animation: fadeIn 1.5s forwards; /* Fade in */
        }
        #welcome-icon {
            font-size: 4.5em; /* Adjusted size for mobile */
            line-height: 1;
            display: block; /* Make it a block to control spacing */
            margin: 0 auto 15px auto; /* Center it and add space below */
            animation: sparkle 2s infinite ease-in-out;
        }
        #welcome-text {
            font-size: 1.8em; /* Adjusted size for mobile */
            font-weight: 700;
            color: var(--primary-color);
            white-space: nowrap; /* Prevent text from wrapping */
        }
        @keyframes fadeIn {
            to { opacity: 1; }
        }
        @keyframes sparkle {
            0%, 100% { transform: scale(1); opacity: 0.8; }
            50% { transform: scale(1.1); opacity: 1; } /* Made sparkle more subtle */
        }

        .app-layout { display: flex; gap: 20px; max-width: 1400px; margin: 0 auto; align-items: flex-start; }
        .main-content { flex-grow: 1; }
        .sidebar { flex: 0 0 280px; position: sticky; top: 20px; }
        .container, .sidebar { background: var(--card-bg); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.5); padding: 20px; border-radius: var(--border-radius); box-shadow: var(--box-shadow); }
        .sidebar h3, #availability-modal-title { color: var(--primary-color); margin-top: 0; border-bottom: 2px solid var(--secondary-color); padding-bottom: 10px; font-size: 1.1em; }
        #available-slots-list, #modal-slots-list { list-style: none; padding: 0; max-height: calc(100vh - 120px); overflow-y: auto; }
        .slot-day-group { margin-bottom: 15px; }
        .slot-day-group h4 { margin: 0 0 8px 0; font-size: 0.9em; color: #555; background-color: var(--secondary-color); padding: 5px 8px; border-radius: 4px;}
        .slot-time { background-color: #e9ecef; padding: 8px 12px; border-radius: 4px; margin-bottom: 5px; font-size: 0.9em; text-align: center; }
        header { display: flex; justify-content: space-between; align-items: center; padding-bottom: 20px; margin-bottom: 20px; flex-wrap: wrap; gap: 10px; }
        header h1 {
            font-weight: 700;
            background: linear-gradient(45deg, var(--primary-color), var(--info-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin: 0; 
            font-size: 1.8em; 
        }
        .controls, .filter-controls { display: flex; gap: 10px; flex-wrap: wrap; align-items: center; }
        button, .btn-file-input { padding: 10px 20px; font-size: 1em; font-weight: 600; border: none; border-radius: var(--border-radius); cursor: pointer; transition: all 0.2s ease; display: inline-block; text-align: center;}
        button:active { transform: scale(0.97); }
        .btn-primary { background-color: var(--primary-color); color: var(--light-text-color); } .btn-primary:hover { background-color: #0b3a8a; box-shadow: 0 4px 10px rgba(13, 71, 161, 0.3); }
        .btn-success { background: linear-gradient(45deg, var(--primary-color), var(--info-color)); color: var(--light-text-color); background-size: 200% auto; } 
        .btn-success:hover { background-position: right center; box-shadow: 0 4px 12px rgba(60, 130, 246, 0.4); }
        .btn-danger { background-color: var(--danger-color); color: var(--light-text-color); } .btn-danger:hover { background-color: #d93333; }
        .btn-secondary { background-color: #64748b; color: var(--light-text-color); } .btn-secondary:hover { background-color: #475569; }
        .tabs { display: flex; margin-bottom: 25px; flex-wrap: wrap; gap: 0; border-bottom: 2px solid var(--border-color); }
        .tab-button { background-color: transparent; border: none; border-bottom: 3px solid transparent; border-radius: 0; padding: 12px 16px; font-weight: 600; color: var(--text-color-light); transition: all 0.2s ease; }
        .tab-button:hover { color: var(--primary-color); }
        .tab-button.active { color: var(--primary-color); border-bottom-color: var(--primary-color); background-color: transparent; font-weight: 600; }
        .tab-content { display: none; } .tab-content.active { display: block; }
        .prospect-card, .reminder-card, .analytics-card, .appointment-card, .settings-card { background: var(--card-bg); border: 1px solid var(--border-color); border-left: 5px solid var(--primary-color); border-radius: var(--border-radius); padding: 20px; margin-bottom: 15px; box-shadow: var(--box-shadow); transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out; }
        .prospect-card:hover { transform: translateY(-4px); box-shadow: 0 10px 20px rgba(30, 41, 59, 0.1); }
        .prospect-actions { margin-top: 15px; display: flex; flex-wrap: wrap; gap: 10px; }
        .prospect-meta { display: flex; flex-wrap: wrap; gap: 0 10px; color: var(--text-color-light); font-size: 0.9em; align-items: center;}
        .prospect-meta span { display: inline-block; }
        .prospect-meta .separator { color: var(--border-color); font-size: 1.2em; }
        .status-badge { padding: 5px 12px; border-radius: 999px; font-weight: 600; font-size: 0.85em; color: #fff; text-align: center; }
        .status-STP { background-color: var(--info-color); } .status-GMS_Appointment { background-color: #f97316; }
        .status-KIT_STP, .status-KIT_GMS { background-color: var(--warning-color); color: var(--text-color); }
        .status-Joined { background-color: var(--accent-color); } .status-Disqualified, .status-Not_Joining { background-color: var(--danger-color); }
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.5); align-items: center; justify-content: center; }
        .modal-content { background-color: #fefefe; margin: auto; padding: 25px; border: 1px solid #888; width: 90%; max-width: 500px; border-radius: var(--border-radius); box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
        .modal-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border-color); padding-bottom: 10px; margin-bottom: 20px; }
        .modal-header h2 { margin: 0; color: var(--primary-color); } .close-button { color: #aaa; font-size: 28px; font-weight: bold; cursor: pointer; }
        .form-group { margin-bottom: 15px; } .form-group label { display: block; margin-bottom: 5px; font-weight: 600; color: var(--text-color); }
        .form-group input, .form-group textarea, .form-group select { width: 100%; padding: 10px; border-radius: 8px; border: 1px solid var(--border-color); box-sizing: border-box; transition: border-color 0.2s, box-shadow 0.2s; }
        .form-group input:focus, .form-group textarea:focus, .form-group select:focus { border-color: var(--primary-color); box-shadow: 0 0 0 3px rgba(13, 71, 161, 0.1); outline: none; }
        .reminders-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 15px; }
        .reminder-card { border-left-color: var(--warning-color); } .appointment-card { border-left-color: var(--info-color); }
        .analytics-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; }
        .analytics-card { text-align: center; border-left-color: var(--accent-color); }
        .analytics-card .value { font-size: 2.5em; font-weight: bold; color: var(--primary-color); }
        .search-bar, #sort-by, #status-filter, #analytics-month { padding: 12px; border-radius: var(--border-radius); border: 1px solid var(--border-color); font-size: 1em; background-color: #fff; }
        .search-bar { flex-grow: 1; } .filter-controls { margin-bottom: 20px; }
        .tags-container { margin-top: 8px; }
        .tag-badge { display: inline-block; background-color: #e9ecef; color: var(--text-color); padding: 3px 8px; border-radius: 12px; font-size: 0.8em; margin-right: 5px; margin-bottom: 5px; }
        .calendar-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; padding: 0 10px; }
        .calendar-header h2 { color: var(--primary-color); margin: 0; text-align: center; }
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; }
        .calendar-day-header { font-weight: bold; text-align: center; padding: 10px 5px; background-color: var(--secondary-color); border-radius: 4px; }
        .calendar-day { border: 1px solid var(--border-color); border-radius: 8px; padding: 8px; min-height: 80px; background-color: white; transition: background-color 0.2s; }
        .calendar-day.other-month { background-color: #f8f9fa; color: #ccc; }
        .calendar-day.today { border: 2px solid var(--primary-color); font-weight: bold; }
        .calendar-day .day-number { font-size: 0.9em; }
        .appointment-dots { margin-top: 5px; display: flex; gap: 4px; }
        .appointment-dot { height: 8px; width: 8px; border-radius: 50%; }
        .dot-stp { background-color: var(--info-color); }
        .dot-gms { background-color: #f97316; }
        .card-header { display: flex; justify-content: space-between; align-items: flex-start; gap: 10px; }
        .card-header h3 { margin-top: 0; flex-grow: 1; line-height: 1.2; }
        .card-menu-container { position: relative; flex-shrink: 0; }
        .menu-toggle-btn { padding: 0 8px; font-size: 1.5em; background: transparent; border: none; line-height: 1; color: #888; }
        .card-menu { display: none; position: absolute; right: 0; top: 100%; background-color: white; border-radius: var(--border-radius); box-shadow: var(--box-shadow); z-index: 10; min-width: 120px; border: 1px solid #eee; }
        .card-menu.open { display: block; }
        .menu-item { display: block; padding: 10px 15px; color: var(--text-color); text-decoration: none; font-size: 0.9em; }
        .menu-item:hover { background-color: var(--secondary-color); }
        .menu-item-danger { color: var(--danger-color); }
        #planner-modal .modal-content { max-width: 800px; }
        .planner-container { display: flex; gap: 20px; flex-wrap: wrap; }
        .planner-appointments, .planner-timeline { flex: 1; min-width: 300px; }
        #planner-appointments-list li { list-style: none; padding-left: 0; margin-bottom: 5px; }
        .planner-timeline { max-height: 400px; overflow-y: auto; border: 1px solid #eee; padding: 10px; border-radius: var(--border-radius); }
        .time-slot { display: block; width: 100%; margin-bottom: 5px; text-align: center; background-color: #e9ecef; border: 1px solid #dee2e6; color: #495057; }
        .time-slot:not(:disabled):hover { background-color: #ced4da; }
        .time-slot.available { background-color: var(--accent-color); color: white; border-color: #1e7e34; }
        .time-slot.booked { background-color: var(--info-color); color: white; border-color: #117a8b; opacity: 0.8; cursor: not-allowed; }
        .planner-footer { margin-top: 20px; text-align: right; }
        .planner-legend { display: flex; gap: 15px; font-size: 0.8em; margin-bottom: 10px; align-items: center; flex-wrap: wrap; }
        #calendar-legend { justify-content: center; margin-bottom: 15px; }
        .legend-item { display: flex; align-items: center; gap: 5px; }
        .legend-color { width: 12px; height: 12px; border-radius: 3px; }
        .legend-color.available { background-color: var(--accent-color); }
        .legend-color.booked { background-color: var(--info-color); }
        .legend-color.busy { background-color: #e9ecef; border: 1px solid #dee2e6; }
        .downline-info { font-size: 0.8em; color: #555; font-style: italic; background-color: #fafafa; padding: 3px 8px; border-radius: 4px; display: inline-block; margin-top: 5px; }
        .toggle-switch { display: flex; gap: 5px; background-color: var(--secondary-color); border-radius: var(--border-radius); padding: 5px; margin-bottom: 15px; }
        .toggle-switch button { flex: 1; background-color: transparent; border: none; padding: 8px; font-weight: normal; }
        .toggle-switch button.active { background-color: white; color: var(--primary-color); font-weight: bold; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        #guide { line-height: 1.8; }
        #guide h2 { color: var(--primary-color); border-bottom: 2px solid var(--border-color); padding-bottom: 10px; margin-top: 30px; }
        #guide h3 { color: var(--text-color); margin-top: 25px; margin-bottom: 10px; }
        #guide hr { border: none; border-top: 1px solid var(--border-color); margin: 30px 0; }
        #guide .legend-item { display: inline-flex; margin-right: 15px; }
        #guide code { background-color: var(--secondary-color); padding: 2px 6px; border-radius: 4px; font-family: "Courier New", Courier, monospace; }
        #show-availability-fab { display: none; position: fixed; bottom: 20px; right: 20px; width: 56px; height: 56px; border-radius: 50%; background-color: var(--primary-color); color: white; font-size: 24px; box-shadow: 0 4px 12px rgba(0,0,0,0.3); border: 2px solid white; align-items: center; justify-content: center; z-index: 1001; }
        .pagination { display: flex; justify-content: center; align-items: center; gap: 5px; margin-top: 25px; }
        .page-btn { background-color: #fff; border: 1px solid var(--border-color); color: var(--primary-color); font-weight: 600; padding: 8px 14px; border-radius: 8px; }
        .page-btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .page-btn.active { background-color: var(--primary-color); color: var(--light-text-color); border-color: var(--primary-color); }
        .page-btn:not(:disabled):hover { background-color: var(--secondary-color); }
        .dashboard-header { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px; }
        
        /* --- START: Login Page Styles --- */
        #auth-container { display: flex; align-items: center; justify-content: center; min-height: calc(100vh - 40px); padding: 20px; box-sizing: border-box; }
        .login-card { background: var(--card-bg); padding: 40px; border-radius: var(--border-radius); box-shadow: 0 10px 30px rgba(0,0,0,0.1); width: 100%; max-width: 420px; text-align: center; border: 1px solid rgba(255, 255, 255, 0.8); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); animation: fadeIn 0.5s ease-out; }
        .login-logo { max-width: 100px; margin: 0 auto 20px; }
        .login-card h2 { margin-top: 0; margin-bottom: 10px; font-size: 1.8em; font-weight: 700; color: var(--primary-color); }
        .login-card p { margin-bottom: 30px; color: var(--text-color-light); }
        .auth-form-group { position: relative; margin-bottom: 20px; }
        .auth-form-group input { width: 100%; padding: 12px 12px 12px 45px; border-radius: var(--border-radius); border: 1px solid var(--border-color); box-sizing: border-box; transition: border-color 0.2s, box-shadow 0.2s; font-size: 1em; }
        .auth-form-group input:focus { border-color: var(--primary-color); box-shadow: 0 0 0 3px rgba(13, 71, 161, 0.1); outline: none; }
        .auth-form-group .icon { position: absolute; left: 15px; top: 50%; transform: translateY(-50%); color: #9ca3af; pointer-events: none; }
         .auth-form-group .password-toggle { position: absolute; right: 15px; top: 50%; transform: translateY(-50%); color: #9ca3af; cursor: pointer; }
        .login-actions button { width: 100%; padding: 12px 20px; font-size: 1.1em; }
        .auth-toggle-link { color: var(--primary-color); text-decoration: none; cursor: pointer; font-weight: 600; }
        .auth-toggle-link:hover { text-decoration: underline; }
        .auth-footer { margin-top: 20px; font-size: 0.9em; color: var(--text-color-light); }
        .forgot-password-link { display: block; margin-top: 15px; color: var(--primary-color); text-decoration: none; font-size: 0.9em; transition: color 0.2s; }
        .forgot-password-link:hover { text-decoration: underline; color: #0b3a8a; }
        /* --- END: Login Page Styles --- */

        /* ===== Flatpickr Custom Theme ===== */
        .flatpickr-calendar { background: var(--card-bg); border: 1px solid var(--border-color); border-radius: var(--border-radius); box-shadow: var(--box-shadow); width: 315px; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; }
        .flatpickr-months .flatpickr-month { color: var(--primary-color); font-weight: 600; font-size: 1rem; height: 40px; }
        .flatpickr-months .flatpickr-prev-month, .flatpickr-months .flatpickr-next-month { padding: 8px; fill: var(--primary-color); transition: background-color 0.2s; border-radius: 50%; }
        .flatpickr-months .flatpickr-prev-month:hover, .flatpickr-months .flatpickr-next-month:hover { background-color: var(--secondary-color); fill: var(--info-color); }
        .flatpickr-current-month .flatpickr-monthDropdown-months, .flatpickr-current-month .numInputWrapper { font-weight: 600; color: inherit; }
        .flatpickr-weekday { color: var(--text-color-light); font-weight: 600; text-transform: uppercase; font-size: 0.7em; }
        .dayContainer { padding: 5px; }
        .flatpickr-day { border: none; border-radius: 50%; transition: background-color 0.2s, color 0.2s, box-shadow 0.2s; font-weight: 500; }
        .flatpickr-day:hover { background-color: var(--secondary-color); color: var(--text-color); }
        .flatpickr-day.today { border: 2px solid var(--accent-color); color: var(--accent-color); }
        .flatpickr-day.today:hover { background-color: var(--accent-color); color: var(--light-text-color); }
        .flatpickr-day.selected, .flatpickr-day.startRange, .flatpickr-day.endRange { background: var(--primary-color); color: var(--light-text-color); border-color: var(--primary-color); box-shadow: 0 0 0 2px var(--primary-color); }
        .flatpickr-day.selected:hover { background: #0b3a8a; }
        .flatpickr-day.disabled { color: rgba(0,0,0,0.2); }
        .flatpickr-time { border-top: 1px solid var(--border-color); background: var(--secondary-color); }
        .flatpickr-time .numInput, .flatpickr-time .flatpickr-am-pm { color: var(--text-color); background: #fff; border: 1px solid var(--border-color); border-radius: 6px; font-weight: 600; }
        .flatpickr-time .numInput:hover, .flatpickr-time .flatpickr-am-pm:hover { background: #eef2f7; }
        .flatpickr-time .numInputWrapper span.arrowUp, .flatpickr-time .numInputWrapper span.arrowDown { opacity: 0.7; transition: opacity 0.2s; }
        .flatpickr-time .numInputWrapper span.arrowUp:hover, .flatpickr-time .numInputWrapper span.arrowDown:hover { opacity: 1; }
        .flatpickr-monthSelect-months { display: block; grid-template-columns: repeat(auto-fit, minmax(95px, 1fr)); gap: 5px; padding: 5px; }
        .flatpickr-monthSelect-month { border-radius: 6px; padding: 10px 5px; font-weight: 500; text-align: center; transition: background-color 0.2s, color 0.2s; cursor: pointer; }
        .flatpickr-monthSelect-month:hover { background-color: var(--secondary-color); color: var(--primary-color); }
        .flatpickr-monthSelect-month.selected { background-color: var(--primary-color); color: var(--light-text-color); }

        /* --- Hover Effect Enhancements --- */
        .reminder-card, .appointment-card { transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out; }
        .reminder-card:hover, .appointment-card:hover { transform: translateY(-3px); box-shadow: 0 8px 16px rgba(30, 41, 59, 0.1); }
        .tab-button:hover { transform: translateY(-2px); background-color: rgba(0,0,0,0.02); }
        .calendar-day { transition: background-color 0.2s, transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out; }
        .calendar-day:not(.other-month):hover { transform: translateY(-3px); box-shadow: var(--box-shadow); cursor: pointer; }
        
        /* --- START: NEW Recurring Availability Styles --- */
        .recurring-day-accordion { border: 1px solid var(--border-color); border-radius: var(--border-radius); margin-bottom: 10px; overflow: hidden; }
        .accordion-header { background-color: var(--secondary-color); padding: 12px 15px; font-weight: 600; cursor: pointer; display: flex; justify-content: space-between; align-items: center; transition: background-color 0.2s; }
        .accordion-header:hover { background-color: #e2e8f0; }
        .accordion-header::after { content: '▼'; font-size: 0.8em; transition: transform 0.3s ease; }
        .accordion-header.active::after { transform: rotate(180deg); }
        .accordion-content { max-height: 0; overflow: hidden; transition: max-height 0.3s ease, padding 0.3s ease; background-color: #fff; padding: 0 15px; }
        .accordion-content.open { max-height: 500px; padding: 15px 15px; }
        .time-block { margin-bottom: 15px; }
        .time-block-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; border-bottom: 1px solid var(--border-color); padding-bottom: 5px; }
        .time-block-header h4 { margin: 0; font-size: 0.9em; color: var(--text-color-light); }
        .select-all-btn { background: none; border: 1px solid var(--primary-color); color: var(--primary-color); padding: 3px 8px; font-size: 0.8em; font-weight: normal; border-radius: 6px; }
        .time-block-slots { display: flex; flex-wrap: wrap; gap: 8px; }
        .slot-chip { background: #e9ecef; padding: 6px 12px; border-radius: 15px; font-size: 0.85em; cursor: pointer; transition: background-color 0.2s, color 0.2s; border: 1px solid transparent; }
        .slot-chip.selected { background: var(--primary-color); color: white; border-color: var(--primary-color); }
        /* --- END: NEW Recurring Availability Styles --- */
        
        /* --- Available Slots Picker --- */
        .available-slots-picker { margin-top: 10px; max-height: 150px; overflow-y: auto; padding: 5px; border: 1px solid var(--border-color); border-radius: 8px; }
        .slot-picker-btn { display: inline-block; width: auto; margin: 3px; padding: 6px 12px; font-size: 0.9em; background-color: var(--secondary-color); border: 1px solid var(--border-color); }
        .slot-picker-btn:hover { background-color: var(--primary-color); color: white; }

        /* Tablet Responsive Styles */
        @media (max-width: 992px) { 
            body { padding: 15px; }
            .app-layout { flex-direction: column; } 
            .sidebar { display: none; }
            #show-availability-fab { display: flex; }
        }

        /* Phone Responsive Styles */
        @media (max-width: 768px) {
            body { padding: 10px; }
            .container, .sidebar { padding: 15px; }
            header { flex-direction: column; align-items: flex-start; gap: 15px; }
            header h1 { font-size: 1.5em; }
            .tabs { flex-wrap: nowrap; overflow-x: auto; padding-bottom: 5px; -ms-overflow-style: none; scrollbar-width: none; }
            .tabs::-webkit-scrollbar { display: none; }
            .tab-button { flex-grow: 0; flex-shrink: 0; }
            .prospect-meta { flex-direction: column; gap: 5px; align-items: flex-start; }
            .prospect-meta .separator { display: none; }
            .dashboard-header { flex-direction: column; align-items: flex-start; gap: 15px; margin-bottom: 20px; }
            .dashboard-header .controls { display: grid; grid-template-columns: 1fr 1fr; width: 100%; }
            .filter-controls { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
            .filter-controls .search-bar { grid-column: 1 / -1; }
            .login-card { padding: 25px; }
            header .controls .btn-success { padding: 10px 15px; font-size: 0.9em; }
            .prospect-card .card-header h3 { display: flex; flex-wrap: wrap; align-items: center; gap: 8px; line-height: 1.4; }
            .prospect-actions { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); }
        }
    </style>
</head>
<body>
    <div id="loading-screen">
        <div class="welcome-message">
            <span id="welcome-icon">💎</span> <span id="welcome-text">欢迎钻石们!</span>
        </div>
    </div>

    <div id="auth-container" style="display: none;">
        <div class="login-card">
            <img src="images/icon-192x192.png" alt="Logo" class="login-logo">
            <h2 id="auth-title">Welcome Back</h2>
            <p id="auth-subtitle">Login to track your prospects.</p>
            
            <div class="auth-form-group">
                <span class="icon">📧</span>
                <input type="email" id="auth-email" placeholder="Email" autocomplete="email">
            </div>
            <div class="auth-form-group">
                <span class="icon">🔒</span>
                <input type="password" id="auth-password" placeholder="Password" autocomplete="current-password">
                <span class="password-toggle" id="password-toggle">👁️</span>
            </div>
            <div class="auth-form-group" id="confirm-password-group" style="display: none;">
                <span class="icon">🔑</span>
                <input type="password" id="auth-confirm-password" placeholder="Confirm Password" autocomplete="new-password">
            </div>

            <div class="login-actions">
                <button class="btn-primary" id="auth-action-btn">Login</button>
            </div>

            <button id="google-signin-btn" class="btn-secondary" style="width:100%; margin-top: 10px;">
                Sign in with Google
            </button>

            <div class="auth-footer">
                <p id="auth-toggle-text">
                    No account? <span class="auth-toggle-link" id="toggle-to-signup">Sign up now</span>.
                </p>
                <a href="#" class="forgot-password-link" id="forgot-password-link">Forgot Password?</a>
            </div>
        </div>
    </div>
    <div class="app-layout" id="main-app" style="display: none;">
        <div class="main-content">
            <div class="container">
                <header>
                    <h1 id="appTitle">Amway Prospect Tracker💎</h1>
                    <div class="controls">
                        <button class="btn-secondary" id="lang-toggle">中文</button>
                        <button class="btn-success" id="add-prospect-btn">➕ Add New Prospect</button>
                    </div>
                </header>
                <div class="tabs">
                    <button class="tab-button active" data-tab="dashboard" id="tabDashboard">Dashboard</button>
                    <button class="tab-button" data-tab="calendar" id="tabCalendar">Calendar</button>
                    <button class="tab-button" data-tab="all-prospects" id="tabAllProspects">All Prospects</button>
                    <button class="tab-button" data-tab="analytics" id="tabAnalytics">Analytics</button>
                    <button class="tab-button" data-tab="settings" id="tabSettings">Settings</button>
                    <button class="tab-button" data-tab="guide" id="tabGuide">Guide</button>
                </div>
                <div id="dashboard" class="tab-content active">
                    <div class="dashboard-header">
                        <h2 id="upcomingAppointmentsTitle">Upcoming Appointments 📅</h2>
                        <div class="controls">
                            <button id="copy-stp-btn" class="btn-secondary">Copy STP List</button>
                            <button id="copy-gms-btn" class="btn-secondary">Copy GMS List</button>
                        </div>
                    </div>
                    <div id="appointments-grid" class="reminders-grid"></div>
                    <h2 id="followUpTitle" style="margin-top: 30px;">Follow-up Needed 📞</h2> 
                    <div id="follow-ups-grid" class="reminders-grid"></div>
                </div>
                <div id="calendar" class="tab-content">
                    <div class="calendar-header">
                        <button id="prev-month">&lt;</button> <h2 id="current-month-year"></h2> <button id="next-month">&gt;</button>
                    </div>
                    <div id="calendar-legend" class="planner-legend">
                        <span class="legend-item"><span class="appointment-dot dot-stp"></span><span id="legend-stp"></span></span>
                        <span class="legend-item"><span class="appointment-dot dot-gms"></span><span id="legend-gms"></span></span>
                    </div>
                    <div id="calendar-grid-header" class="calendar-grid"></div>
                    <div id="calendar-grid-body" class="calendar-grid"></div>
                </div>
                <div id="all-prospects" class="tab-content">
                    <h2 id="allProspectsTitle">All Prospects</h2>
                    <div class="toggle-switch" id="prospect-view-toggle"></div>
                    <div class="filter-controls">
                        <input type="search" id="search-input" class="search-bar">
                        <select id="status-filter"></select>
                        <select id="sort-by"></select>
                    </div>
                    <div id="prospect-list" class="prospect-list"></div>
                    <div id="pagination-controls" class="pagination"></div>
                </div>
                <div id="analytics" class="tab-content">
                    <h2 id="analyticsTitle">Monthly Analytics</h2>
                    <div class="toggle-switch" id="analytics-view-toggle"></div>
                    <div id="downline-analytics-controls" class="form-group" style="display: none;">
                        <label for="downline-filter" id="downline-filter-label">Filter by Downline:</label>
                        <select id="downline-filter"></select>
                    </div>
                    <div class="form-group"> <label for="analytics-month" id="analyticsMonthLabel">Select Month:</label> <input type="text" id="analytics-month"> </div>
                    <div id="analytics-summary" class="analytics-grid"></div>
                    <hr>
                    <h3 id="analytics-trend-title" style="text-align: center; color: var(--primary-color);">6-Month Performance Trend</h3>
                    <div id="trend-chart-container" style="position: relative; height:40vh; width:100%; margin-top: 20px;">
                        <canvas id="analyticsTrendChart"></canvas>
                    </div>
                </div>
                <div id="settings" class="tab-content">
                    <h2 id="settingsTitle">Data & Settings</h2> 
                    
                    <div class="settings-card" style="border-left-color: var(--warning-color);">
                         <h3>Account</h3>
                         <p><strong>Logged in as:</strong> <span id="user-email"></span></p>
                         <div class="controls">
                             <button id="logout-btn" class="btn-secondary">Logout</button>
                         </div>
                    </div>

                    <div class="settings-card" style="border-left-color: var(--accent-color); margin-top: 20px;">
                        <h3 id="recurringAvailabilityTitle">Set Recurring Weekly Availability</h3>
                        <p id="recurringAvailabilityDesc">Set your fixed weekly schedule here. These slots will be automatically applied to future dates.</p>
                        <div id="recurring-availability-form"></div>
                        <button id="save-recurring-btn" class="btn-primary" style="margin-top: 15px;">Save Recurring Slots</button>
                    </div>
                    
                    <div class="settings-card" style="border-left-color: var(--primary-color); margin-top: 20px;">
                        <h3 id="backupSyncTitle">Backup & Sync</h3>
                        <p id="backupSyncDesc">Export all your data (prospects and availability) to a single file. You can Save this file as a backup or import it on another device to sync your data.</p>
                        <div class="controls">
                            <button id="exportData" class="btn-primary">Export Data</button>
                            <label class="btn-secondary btn-file-input">
                                <span id="importDataLabel">Import Data</span> <input type="file" id="importData" accept=".json" style="display: none;">
                            </label>
                        </div>
                    </div>

                    <div class="settings-card" style="border-left-color: var(--info-color); margin-top: 20px;">
                        <h3>Data Status</h3>
                        <p><strong>Last Synced/Imported:</strong> <span id="last-sync-time">Never</span></p>
                        <p><strong>Total Prospects:</strong> <span id="total-prospects">0</span></p>
                    </div>

                    <div class="settings-card" style="border-left-color: var(--danger-color); margin-top: 20px;">
                         <h3 id="dangerZoneTitle">Danger Zone</h3>
                         <p id="dangerZoneDesc">this action will permanently delete all your prospect and availability data.</p>
                         <button id="clearData" class="btn-danger">Clear All Data</button>
                    </div>
                </div>
                 <div id="guide" class="tab-content">
                    <h2 id="guide-main-title">Amway Prospect tracker - User Guide</h2>
                    <hr>
                    <h3 id="guide-getting-started-title">1. Getting Started: How to Use This File</h3>
                    <p id="guide-getting-started-p1">Welcome! This tracker is a standalone, single-file application. You don't need to install any special software to use it.</p>
                    <p><strong><span id="guide-getting-started-p2">To begin:</span></strong></p>
                    <ul>
                        <li id="guide-getting-started-li1"><b>Save the File:</b> Save the .html file to a convenient location on your computer, like your Desktop or a dedicated folder.</li>
                        <li id="guide-getting-started-li2">Open the File:</b> To launch the application, simply double-click the file. It will open in your default web browser (Google Chrome, Firefox, or Microsoft Edge are recommended).</li>
                        <li id="guide-getting-started-li3">Important Note on Data Storage:</b> Your data (all prospects, availability, etc.) is saved directly in your web browser's local storage. This means:<ul><li><b>It's Private:</b> Your data stays on your computer and is not sent over the internet.</li><li><b>It's Browser-Specific:</b> Data saved while using Chrome will not be visible if you open the file in Firefox, and vice-versa. Always use the same browser for consistency.</li><li><b>It's Device-Specific:</b> The data will not automatically sync to another computer or your phone. Please use the 'Backup & Sync' feature for this.</li></ul></li>
                    </ul>

                    <h3 id="guide-interface-title">2. The Main Interface 🗺️</h3>
                    <p id="guide-interface-p1">The application is designed to be responsive and looks great on desktop, tablet, or phone.</p>
                    <ul>
                        <li id="guide-interface-li1"><b>Main Content Area:</b> This is where you'll interact with your data through different tabs.</li>
                        <li id="guide-interface-li2"><b>Sidebar (Desktop View):</b> On larger screens, this panel automatically shows your upcoming available time slots for quick scheduling.</li>
                        <li id="guide-interface-li3">Floating Button (Mobile/Tablet View):</b> On smaller screens, the sidebar is replaced by a floating calendar button (📅) in the bottom-right corner. Tapping this opens a pop-up with your available slots.</li>
                    </ul>
                    
                    <h3 id="guide-dashboard-title">3. Managing Your Day: The Dashboard & Calendar</h3>
                    <p id="guide-dashboard-p1"><b>The Dashboard Tab</b><br>This is your home screen, giving you a quick overview of what's important:</p>
                    <ul>
                        <li id="guide-dashboard-li1"><b>Upcoming Appointments 📅:</b> Shows all your future STP and GMS appointments, sorted by the soonest first.</li>
                        <li id="guide-dashboard-li2"><b>One-Click Copy Buttons:</b> Next to the title, you will find 'Copy STP List' and 'Copy GMS List'. Clicking these will copy a pre-formatted summary of your upcoming appointments for that category, ready to paste into WhatsApp or other messaging apps to update your upline.</li>
                        <li id="guide-dashboard-li3"><b>Follow-up Needed 📞:</b> Lists all prospects currently in the 'Keep In Touch' (KIT) stage.</li>
                    </ul>

                    <h3 id="guide-calendar-title">The Calendar Tab & Availability Planner</h3>
                    <p id="guide-calendar-p1">This is your command center for time management.</p>
                    <div class="planner-legend" style="justify-content: flex-start; margin-left: 20px;">
                        <span class="legend-item"><span class="appointment-dot dot-stp"></span><span id="legend-stp-guide"></span></span>
                        <span class="legend-item"><span class="appointment-dot dot-gms"></span><span id="legend-gms-guide"></span></span>
                    </div>
                    <p id="guide-calendar-p2"><b>Daily Availability Planner:</b> Click on any day in the calendar to open the planner. In this pop-up, you can:</p>
                    <ul>
                        <li id="guide-calendar-li1"><b>View Confirmed Appointments:</b> See a list of who you're meeting that day.</li>
                        <li id="guide-calendar-li2"><b>Set Your Free Time:</b> Click on the 30-minute time slots to mark them as available.</li>
                        <li id="guide-calendar-li3"><b>Save:</b> Click "Save Availability". The times you marked will now appear in the sidebar or the floating button's pop-up.</li>
                    </ul>

                    <h3 id="guide-prospects-title">4. Managing Your Prospects: The All Prospects Tab</h3>
                    <p><strong><span id="guide-prospects-p1">Adding and Editing a Prospect:</span></strong></p>
                    <ul>
                        <li id="guide-prospects-li1">Click the ➕ Add New Prospect button in the header.</li>
                        <li id="guide-prospects-li2">In the form, you can specify if the prospect belongs to "Myself" or "My Downline". If you select a downline, you can choose an existing one from a list or type a new name.</li>
                        <li id="guide-prospects-li3">Fill in all details and click Save. The elegant date and time picker makes scheduling intuitive.</li>
                    </ul>
                    <p><strong><span id="guide-prospects-p2">Filtering and Sorting:</span></strong></p>
                    <ul>
                        <li id="guide-prospects-li4"><b>View Toggles:</b> At the top, you can filter between "My Prospects", "Downline's", or "All".</li>
                        <li id="guide-prospects-li5"><b>Search, Filter, and Sort:</b> Use the search bar to find someone by name, phone, or tag. Use the Status Filter dropdown to narrow the list by their current status (e.g., show only 'Joined' prospects). You can also sort the results by date, name, or status.</li>
                    </ul>
                    <p><strong><span id="guide-prospects-p3">Pagination:</span></strong> To keep the list clean and fast, prospects are shown on pages. Use the navigation controls at the bottom to move between pages.</p>

                    <h3 id="guide-analytics-title">5. Tracking Your Progress: The Analytics Tab 📊</h3>
                    <p id="guide-analytics-p1">This tab helps you measure your activity and your team's progress with visual data.</p>
                    <ul>
                        <li id="guide-analytics-li1"><b>View Toggles:</li>
                    </ul>
                    <p><strong><span id="guide-analytics-p2">Filters:</span></strong></p>
                    <ul>
                        <li id="guide-analytics-li2">Use the clean, grid-style Month Picker to select the month you want to review.</li>
                        <li id="guide-analytics-li3">When in 'Downline Support' view, you can use the Filter by Downline dropdown to see statistics for a specific downline or all of them combined.</li>
                    </ul>
                    <p><strong><span id="guide-analytics-p3">6-Month Performance Trend Chart:</span></strong> This interactive line chart visualizes your performance over the last six months for your four key metrics. Hover over any point to see details, and click the legend at the top to toggle lines on or off.</p>
                    
                    <h3 id="guide-settings-title">6. Settings: Data Management & Syncing ⚙️</h3>
                    <p id="guide-settings-p1">This is where you manage your application data.</p>
                    <ul>
                        <li id="guide-settings-li1"><b>Data Status:</b> See at a glance when your data was last synced and the total number of prospects you have.</li>
                    </ul>
                    <p><strong><span id="guide-settings-p2">Backup & Sync:</span></strong> This is the most important feature for keeping your data safe and synchronized across devices.</p>
                    <p><strong><span id="guide-settings-p3">Danger Zone:</span></strong></p>
                    <ul>
                        <li id="guide-settings-li2"><b>Clear All Data:</b> Use with caution! This will permanently delete all prospect records and availability data. This action cannot be undone.</li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="sidebar">
            <h3 id="sidebar-title">Upcoming Available Slots</h3>
            <div id="available-slots-list"></div>
        </div>
    </div>
    
    <div id="prospect-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header"> <h2 id="modal-title">Add New Prospect</h2> <span class="close-button" id="close-modal">&times;</span> </div>
            <form id="prospect-form">
                <input type="hidden" id="prospect-id">
                 <div class="form-group">
                    <label id="owner-type-label">This prospect belongs to:</label>
                    <select id="owner-type">
                        <option value="user" id="owner-user-option">Myself</option>
                        <option value="downline" id="owner-downline-option">My Downline</option>
                    </select>
                </div>
                <div class="form-group" id="downline-name-group" style="display: none;">
                    <label for="downline-name" id="downline-name-label">Downline's Name:</label>
                    <input type="text" id="downline-name" list="downline-names-list">
                    <datalist id="downline-names-list"></datalist>
                </div>
                <div class="form-group"> <label for="name" id="labelName">Name:</label> <input type="text" id="name" required> </div>
                <div class="form-group"> <label for="phone" id="labelPhone">Phone:</label> <input type="text" id="phone"> </div>
                <div class="form-group"> <label for="age" id="labelAge">Age:</label> <input type="number" id="age"> </div>
                <div class="form-group"> <label for="occupation" id="labelOccupation">Occupation:</label> <input type="text" id="occupation"> </div>
                <div class="form-group"> <label for="tags" id="labelTags">Tags (comma-separated):</label> <input type="text" id="tags"> </div>
                <div class="form-group">
                    <label for="stp-datetime" id="labelStpTime">STP Appointment Time:</label>
                    <input type="text" id="stp-datetime" required>
                    <div id="stp-available-slots" class="available-slots-picker"></div>
                </div>
                <div class="form-group"> <label for="notes" id="labelNotes">Notes:</label> <textarea id="notes" rows="3"></textarea> </div>
                <button type="submit" class="btn-success" id="save-prospect-btn">Save</button>
            </form>
        </div>
    </div>
    <div id="action-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header"> <h2 id="action-modal-title">Update Prospect Status</h2> <span class="close-button" id="action-close-modal">&times;</span> </div>
            <form id="action-form">
                <input type="hidden" id="action-prospect-id"> <input type="hidden" id="action-type">
                <div class="form-group" id="gms-schedule-group" style="display:none;">
                    <label for="gms-datetime" id="labelGmsTime">GMS Appointment Time:</label>
                    <input type="text" id="gms-datetime">
                    <div id="gms-available-slots" class="available-slots-picker"></div>
                </div>
                <div class="form-group"> <label for="action-notes" id="labelActionNotes">Follow-up Notes (Optional):</label> <textarea id="action-notes" rows="4"></textarea> </div>
                <button type="submit" class="btn-success" id="confirm-action-btn">Confirm</button>
            </form>
        </div>
    </div>
    <div id="planner-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header"> <h2 id="planner-title">Daily Availability Planner</h2> <span class="close-button" id="close-planner-modal">&times;</span> </div>
            <div class="planner-container">
                <div class="planner-appointments">
                    <h3 id="planner-appointments-title">Confirmed Appointments</h3>
                    <ul id="planner-appointments-list"></ul>
                </div>
                <div class="planner-timeline">
                    <h3 id="planner-timeline-title">Set Your Availability</h3>
                    <div class="planner-legend">
                        <span class="legend-item"><span class="legend-color available"></span><span id="legend-available">Available</span></span>
                        <span class="legend-item"><span class="legend-color booked"></span><span id="legend-booked"></span>Booked</span>
                        <span class="legend-item"><span class="legend-color busy"></span><span id="legend-busy"></span>Busy</span>
                    </div>
                    <div id="planner-timeline-slots"></div>
                </div>
            </div>
            <div class="planner-footer">
                <button class="btn-primary" id="save-availability-btn">Save Availability</button>
            </div>
        </div>
    </div>
    <div id="availability-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header"> 
                <h2 id="availability-modal-title">Upcoming Available Slots</h2> 
                <span class="close-button" id="close-availability-modal">&times;</span> 
            </div>
            <div id="modal-slots-list"></div>
        </div>
    </div>

    <div id="forgot-password-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="forgot-password-title">Reset Password</h2>
                <span class="close-button" id="close-forgot-password-modal">&times;</span>
            </div>
            <p id="forgot-password-instructions">Enter your email address and we will send you instructions to reset your password.</p>
            <div class="form-group">
                <label for="reset-email" id="label-reset-email">Email</label>
                <input type="email" id="reset-email" placeholder="your.email@example.com">
            </div>
            <button class="btn-primary" id="send-reset-btn" style="width: 100%;">Send Reset Instructions</button>
        </div>
    </div>
    <button id="show-availability-fab">📅</button>

    <script defer src="libs/supabase.js"></script>
    <script defer src="libs/flatpickr.js"></script>
    <script defer src="libs/monthSelect.js"></script>
    <script defer src="libs/chart.js"></script>

    <script defer src="app.js"></script>

<script>
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('/sw.js')
                .then(registration => {
                    console.log('ServiceWorker registration successful with scope: ', registration.scope);
                })
                .catch(err => {
                    console.log('ServiceWorker registration failed: ', err);
                });
        });
    }
</script>
</body>
</html>